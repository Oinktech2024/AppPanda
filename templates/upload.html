<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/waves/0.7.6/waves.min.css">
    <link rel="icon" href="images/favicon.ico">
    <title>AppPanda</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
       
    </style>
</head>
<body>

    <!-- å´é‚Šæ¬„ -->
    <div class="sidebar" id="mySidebar">
        <a href="/" style="display: flex; flex-direction: column; align-items: center;">
            <img src="images/icon.png" alt="Image" class="icon-image">
            <h3>AppPanda</h3>
        </a>
        <a href="apk">APK</a>
        <a href="exe">EXE</a>
        <a href="ipa">IPA</a>
        <a href="comparison">Comparison</a>
        <a href="aboutus">AboutUs</a>
    </div>

    <!-- æ¼¢å ¡èœå–®æŒ‰éˆ• -->
    <span class="hamburger-menu" onclick="toggleNav()">ï¼</span>

    <!-- ä¸Šæ–¹å°èˆªæ¬„ -->
    <nav class="navbar">
        <a href="/" style="display: flex; align-items: center;">
            <img src="images/icon.png" alt="Image" class="icon-image">
            <h3>AppPanda</h3>
        </a>
        <a href="apk">APK</a>
        <a href="exe">EXE</a>
        <a href="ipa">IPA</a>
        <a href="comparison">Comparison</a>
        <a href="aboutus">AboutUs</a>
        
        <div class="search-container">
            <div class="search-wrapper">
                <input type="text" class="search-input" placeholder="Search...">
                <button class="search-button">ğŸ”</button>
            </div>
        </div>
        
        {% if user.is_authenticated %}
            <a href="dashboard" class="login-a">Dashboard</a>
        {% else %}
            <a href="login" class="login-a">Login/Register</a>
        {% endif %}
    </nav>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="content">
        <h1>Upload</h1>
        <div id="flash-messages">
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <ul>
                        {% for message in messages %}
                            <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endwith %}
        </div>

        <form action="/upload-file" method="post" enctype="multipart/form-data">
            <!-- ä¿®æ”¹ç‚ºæ‹–æ”¾å€åŸŸ -->
            <div id="upload-area" class="upload-area">
                æ‹–æ”¾æª”æ¡ˆæˆ–é»æ“Šé€™è£¡é¸æ“‡æª”æ¡ˆ
            </div><br><br>

            <input type="file" id="file" name="file" onchange="showForm()" style="display:none;" accept=".exe, .apk, .ipa" required>
            <small>è«‹ä¸Šå‚³ .exeã€.ipaã€æˆ– .apk æª”æ¡ˆã€‚</small><br><br>

            <div id="form-section" style="display:none;">
                <h2>æ‡‰ç”¨è³‡è¨Š</h2>
                <label for="version">ç‰ˆæœ¬:</label><br>
                <input type="text" id="version" name="version" required>
                <small>è«‹è¼¸å…¥æ‡‰ç”¨çš„ç‰ˆæœ¬è™Ÿï¼Œä¾‹å¦‚ 1.0.0ã€‚</small><br><br>

                <label for="app_name">æ‡‰ç”¨åç¨±:</label><br>
                <input type="text" id="app_name" name="app_name" required>
                <small>è«‹è¼¸å…¥æ‡‰ç”¨çš„åç¨±ï¼Œé€™å°‡ç”¨æ–¼æª”æ¡ˆè¨˜éŒ„ã€‚</small><br><br>

                <label for="app_tags">æ‡‰ç”¨æ¨™ç±¤ (ç”¨é€—è™Ÿåˆ†éš”):</label><br>
                <input type="text" id="app_tags" name="app_tags" required>
                <small>è«‹ç”¨é€—è™Ÿåˆ†éš”æ¯å€‹æ¨™ç±¤ï¼Œä¾‹å¦‚ã€Œæ•™è‚²,éŠæˆ²,ç”Ÿç”¢åŠ›ã€ã€‚</small><br><br>
                
                {% if user.is_authenticated %}
                <label for="uploader_name">ä¸Šå‚³è€…åç¨±:</label><br>
                <input type="text" id="uploader_name" name="uploader_name" value="{{ user.username }}" readonly>
                <small>é€™æ˜¯æ‚¨çš„ä¸Šå‚³è€…åç¨±ï¼Œç„¡æ³•æ›´æ”¹ã€‚</small><br><br>
                {% else %}
                {% endif %}
                
                <label for="app_type">æ‡‰ç”¨é¡å‹:</label><br>
                <input type="text" id="app_type" name="app_type" readonly>
                <small>æ ¹æ“šæª”æ¡ˆé¡å‹è‡ªå‹•è¨­å®šï¼Œå¦‚ iOSã€Androidã€Windowsã€‚</small><br><br>

                <button type="submit">ä¸Šå‚³</button>
            </div>
        </form>
    </div>

    <script src="js/script.js"></script>
    <script>
        function showForm() {
                var fileInput = document.getElementById('file');
                var file = fileInput.files[0];
                var fileExtension = file.name.split('.').pop().toLowerCase();

                document.getElementById('form-section').style.display = 'block';
                var appType = '';

                if (fileExtension === 'ipa') {
                    appType = 'iOS';
                } else if (fileExtension === 'apk') {
                    appType = 'Android';
                } else if (fileExtension === 'exe') {
                    appType = 'Windows';
                } else {
                    appType = 'Other';
                }

                document.getElementById('app_type').value = appType;
            }

        // è™•ç†æª”æ¡ˆ
        function handleFiles(files) {
            // æ¸…é™¤ Flash è¨Šæ¯ä¸¦éš±è—è¡¨å–®
            document.getElementById('flash-messages-container').innerHTML = '';  
            document.getElementById('form-section').style.display = 'none';  

            if (files.length === 0) {
                return;
            }

            const file = files[0];
            const fileExtension = file.name.split('.').pop().toLowerCase();

            // æª¢æŸ¥æª”æ¡ˆé¡å‹
            if (['exe', 'ipa', 'apk'].indexOf(fileExtension) === -1) {
                showFlashMessage('Invalid file type. Only EXE, IPA, and APK files are allowed.');
                return;
            }

            showForm(file);
        }

        // é¡¯ç¤º Flash è¨Šæ¯
        function showFlashMessage(message) {
            const flashContainer = document.getElementById('flash-messages-container');
            const flashMessage = document.createElement('div');
            flashMessage.classList.add('flash-message');
            flashMessage.innerText = message;

            flashContainer.appendChild(flashMessage);
        }

        // ä¸Šå‚³å€åŸŸçš„äº‹ä»¶è™•ç†
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file');

        // æ‹–æ”¾è™•ç†
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        // é»æ“Šè™•ç†
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', () => {
            const files = fileInput.files;
            handleFiles(files);
        });
        
    </script>
</body>
</html>
